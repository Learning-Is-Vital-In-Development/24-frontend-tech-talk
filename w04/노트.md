# 4주차 (01/23)

# Git Submodule

깃 저장소에 다른 깃 저장소 중첩
다른 레포 특정 버전을 현재 프로젝트에 포함
Git 1.5.3에서 도입

## 적용 계기

- 여러 프로젝트에서 같은 모듈 사용 -> 공통 모듈 만들자

- 패키지매니저, 모노레포 등 다른 방법을 사용할 수 도 있으나 러닝커브가 짧은 서브모듈 선택함

## 적용하기

### submodule 추가

```
git submodule add 다른저장소url
```

`.gitmodules` 파일이 생성됨(링크)

서브모듈 디렉토리 자체를 특별한 커밋으로 취급

```
git diff --cached --submodule
```

submodule 레포지토리의 마지막 커밋 해시를 들고감
![image](https://hackmd.io/_uploads/SkGXpGTYT.png)

### clone할 때

git clone 하면 submodule에 해당하는 디렉토리들은 빈 파일인데 아래 명령어를 실행하면 완전히 클론됨

```
git submodule init
git submodule update
```

### git subtree

일부분이 명합된 형태
main 프로젝트에서 submodule 수정 가능
git submodule은 main프로젝트에서 수정 가능하지만 푸시하는 방식은 복잡함

```
git checkout stable
git submodule update --remote --merge
```

1. 서브모듈의 브랜치를 바꿔줘야한다. (.gitmodules 파일안에 특정 서브모듈에 branch = 생성브랜치명 이런식으로 추가됨)
2. 해당 서브모듈 폴더로 들어가서 작업해야한다.
3. 파일을 수정한다.
4.

git submodule update --remote

## 문제점

- 업데이트 & 동기화의 어려움(수동 업데이트)
- 버전 추적 어려움
- 다른 의존성 관리 도구 존재
- 변동 심하거나 의존성이 강하다면 적합하지 않을 수 있다.

## 잡담

- 명령어에 자동으로 `--recurse-submodules` 옵션 붙여주는 설정
  - `git config --global submodule.recurse true`
  - 이거 근데 붙이면 항상 붙은채로 실행이되는거죠?
  - 그런거같네요
- 서브 모듈 푸시됐는지 확인?

## 질문

1. 어떨때 왜 쓰는건지? 쓰면서 불편한 점? 장단점?
   - 모노래포 개념이 나오기 전에 썼던거 같음. 보안파일 관리시에도 사용?
2. 해당 파일이 서브모듈이라고 인식하는 파일은 뭔지?
   - .git 안에 submodule 파일로 관리를 하고 있음. .gitmodules 도 관리
3. 서브모듈폴더로 들어가서 git fetch가 동작할수있는 원리? 어떤 파일이 있길래 git fetch가 실행이되는건지. 아 혹시 .git이런거있는건가
   - 각각 다른 깃 프로젝트.
4. npm i, npm update 이런거하면 영향을 안받는지? 안받겠죠??????
   - 안받을 듯.
5. peerDependencies와는 관계가 없는지?

## 관련 토픽 주제

1. monorepo vs multirepo vs monolith repo

- monorepo 설정 빡셈
- 소규모회사라면 monolith repo가 좋을 수도>?

2. 라이브러리/프레임워크 선택시 우선순위, 기준, 경험

- npm trend
- issue
- 유지보수 얼마나 잘되고 있나(버전 관리)
- 다운로드 수, 번들 사이즈
- 번들포비아 (번들사이즈 확인가능)
- next.js
  - dynamic import

3. 브랜치전략, 배포주기, CI/CD

- git flow
- github flow
- trunk-based development (commit train)
  - 브랜치 하나만
  - squash merge
  - 로그 깔끔, 로그 내용도 pr제목만 보임
  - 디버깅 힘듦
  - merge 커밋이 안쌓임
- changeset : 버전관리 도와주는 도구
- CI/CD :
  - 개발자마다 QA환경을 각각 띄우는가?
    - 각 피처별로 격리시켜서 QA해야 하니까 필요할 듯.
    - PR 별로, 또는 스토리별로 환경이 구성되면 좋긴 한데, 인프라 지원이 어렵지 않나?
      - 일단 최선은 걍 서버를 여러개 만드는 게..
    - next 사용할 때 pr 단위로 서버 분리가 되는가?
